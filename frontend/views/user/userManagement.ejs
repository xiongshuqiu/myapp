<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>chinaz</title>
    <!-- 1.框架样式：Bootstrap Styles-->
    <link href="/assets/css/bootstrap.css" rel="stylesheet" />
    <!-- 2.图标样式：FontAwesome Styles-->
    <link href="/assets/css/font-awesome.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <!--3.普通样式：Custom Styles-->
    <link href="/assets/css/custom-styles.css" rel="stylesheet" />
    <!-- 4.字体样式：Google Fonts-->
    <link
      href="http://fonts.useso.com/css?family=Open+Sans"
      rel="stylesheet"
      type="text/css"
    />
    <!-- 5.表格样式：TABLE STYLES-->
    <link
      href="/assets/js/dataTables/dataTables.bootstrap.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="wrapper">
      <!-- 顶部导航条 -->
      <%- include('../block/top-navbar.ejs') %>
      <!-- 左侧导航条 -->
      <%- include('../block/navbar-side.ejs') %>

      <div id="page-wrapper">
        <div class="header">
          <h1 class="page-header">
            User Management <small> User Information</small>
          </h1>
          <ol class="breadcrumb">
            <!-- 面包屑导航 -->
            <li><a href="#">Home</a></li>
            <!-- 首页链接 -->
            <li><a href="#">User Management</a></li>
            <!-- 用户管理页面链接 -->
            <li class="active">User Data</li>
            <!-- 当前页：用户数据 -->
          </ol>
        </div>

        <!-- 页面内部内容 -->
        <div id="page-inner">
          <div class="row">
            <div class="col-md-12">
              <!-- Advanced Tables -->
              <div class="panel panel-default">
                <div class="panel-heading">User Tables</div>
                <div class="panel-body">
                  <div class="table-responsive">
                    <table
                      class="table table-striped table-bordered table-hover"
                      id="dataTables-example"
                    >
                      <thead>
                        <tr>
                          <th>userID</th>
                          <th>account</th>
                          <th>userName</th>
                          <th>password</th>
                          <th>phoneNumber</th>
                          <th>email</th>
                          <th>role</th>
                          <th>actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% users.forEach(function(user) { %>
                        <tr class="odd gradeX" style="white-space: nowrap">
                          <td><%= user.userId %></td>
                          <td><%= user.account %></td>
                          <td><%= user.userName %></td>
                          <td><%= user.passWord %></td>
                          <td><%= user.phoneNumber %></td>
                          <td><%= user.email %></td>
                          <td><%= user.role %></td>
                          <td>
                            <a
                              href="/users/<%= user._id %>/update"
                              class="editLink"
                              style="color: blue; display: inline"
                              >Edit</a
                            >
                            <!-- 链接的href属性: 使用href="javascript:void(0)"避免页面跳转，确保点击链接时不会重定向。
                            onclick事件: 直接调用JavaScript函数confirmDeletion('<%= user._id %>')来处理删除逻辑。
                            #代替javascript:void(0)可能会跳转到顶部 -->
                            <a
                              href="javascript:void(0)"
                              class="deleteLink"
                              style="color: red; padding: 5px; display: inline"
                              onclick="confirmDeletion('<%= user._id %>')"
                              >Delete</a
                            >
                            <form
                              id="delete-form-<%= user._id %>"
                              action="/users/<%= user._id %>/delete"
                              method="post"
                              style="display: none"
                            >
                              <input
                                type="hidden"
                                name="_method"
                                value="DELETE"
                              />
                            </form>
                          </td>
                        </tr>
                        <% }); %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!--End Advanced Tables -->
            </div>
          </div>
        </div>

        <footer>
          <p>
            Copyright &copy; 2016.Company name All rights reserved.<a
              target="_blank"
              href="http://sc.chinaz.com/moban/"
              >模板网站</a
            >
          </p>
        </footer>
      </div>
      <!-- /. PAGE INNER  -->
    </div>
    <!-- /. PAGE WRAPPER  -->
    <!-- /. WRAPPER  -->
    <!-- JS Scripts-->
    <!-- jQuery Js -->
    <script src="/assets/js/jquery-1.10.2.js"></script>
    <!-- Bootstrap Js -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Metis Menu Js -->
    <script src="/assets/js/jquery.metisMenu.js"></script>
    <!-- DATA TABLE SCRIPTS -->
    <script src="/assets/js/dataTables/jquery.dataTables.js"></script>
    <script src="/assets/js/dataTables/dataTables.bootstrap.js"></script>
    <script>
      // 1.当文档加载完成并且 DOM 准备就绪时，执行内部的函数
      $(document).ready(function () {
        // 初始化 DataTable 插件，并将其绑定到 ID 为 dataTables-example 的表格元素
        // # 是用来选择元素的 ID 属性的选择器
        var table = $('#dataTables-example').DataTable();

        // 2.在过滤器区域添加 "Add User" 按钮
        $('#dataTables-example_filter').append(
          '<button id="addUser" class="btn btn-primary add-user-btn">Add User</button>',
        );
        // 处理 "Add User" 按钮点击事件
        $('#addUser').on('click', function () {
          window.location.href = '/users/new';
        });
      });
      //3.添加删除对话框
      async function confirmDeletion(_id) {
        if (confirm('Are you sure you want to delete this user?')) {
          try {
            const response = await fetch(`/users/${_id}/delete`, {
              method: 'DELETE',
            });
            window.location.href = '/users/';
            // const result = await response.json();
            // alert(result.message); // 显示反馈给用户
            location.reload(); // 刷新页面以更新用户表
          } catch (error) {
            alert('An error occurred while deleting the user.');
            console.error('Error:', error);
          }
        }
      }
    </script>
    <!-- Custom Js -->
    <script src="/assets/js/custom-scripts.js"></script>
  </body>
</html>
