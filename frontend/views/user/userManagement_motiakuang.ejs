<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>chinaz</title>
    <!-- 1.框架样式：Bootstrap Styles-->
    <link href="/assets/css/bootstrap.css" rel="stylesheet" />
    <!-- 2.图标样式：FontAwesome Styles-->
    <link href="/assets/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <!--3.普通样式：Custom Styles-->
    <link href="/assets/css/custom-styles.css" rel="stylesheet" />
    <!-- 4.字体样式：Google Fonts-->
    <link
  href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"
  rel="stylesheet"
  type="text/css"
/>

    <!-- 5.表格样式：TABLE STYLES-->
    <link href="/assets/js/dataTables/dataTables.bootstrap.css" rel="stylesheet" />
  </head>

  <body>
    <div id="wrapper">
      <!-- 顶部导航条 -->
      <%- include('../block/top-navbar_other.ejs') %>
      <!-- 左侧导航条 -->
      <%- include('../block/navbar-side.ejs') %>

      <div id="page-wrapper">
        <div class="header">
          <h1 class="page-header">
            User Management <small> User Information</small>
          </h1>
          <ol class="breadcrumb">
            <!-- 面包屑导航 -->
            <li><a href="#">Home</a></li>
            <!-- 首页链接 -->
            <li><a href="#">User Management</a></li>
            <!-- 用户管理页面链接 -->
            <li class="active">User Data</li>
            <!-- 当前页：用户数据 -->
          </ol>
        </div>

        <!-- 页面内部内容 -->
        <div id="page-inner">
          <div class="row">
            <div class="col-md-12">
              <!-- Advanced Tables -->
              <div class="panel panel-default">
                <div class="panel-heading">User Tables</div>
                <div class="panel-body">
                  <div class="table-responsive">
                    <table
                      class="table table-striped table-bordered table-hover"
                      id="dataTables-example"
                    >
                      <thead>
                        <tr>
                          <th>userID</th>
                          <th>account</th>
                          <th>userName</th>
                          <th>password</th>
                          <th>phoneNumber</th>
                          <th>email</th>
                          <th>role</th>
                          <th>actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% users.forEach(function(user) { %>
                        <tr class="odd gradeX" style="white-space: nowrap">
                          <td><%= user.userId %></td>
                          <td><%= user.account %></td>
                          <td><%= user.userName %></td>
                          <td><%= user.passWord %></td>
                          <td><%= user.phoneNumber %></td>
                          <td><%= user.email %></td>
                          <td><%= user.role %></td>
                          <td>
                            <a
                              href="/user/<%= user._id %>"
                              class="editLink"
                              style="color: blue; display: inline"
                              >Edit</a
                            >
                            <td>
                              <a
                                  href="javascript:void(0)"
                                  class="deleteLink"
                                  style="color: red; padding: 5px; display: inline"
                                  data-id="<%= user._id %>"
                                  >Delete</a
                              >
                          </td>
                          
                            >
                          </td>
                        </tr>
                        <% }); %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!--End Advanced Tables -->
            </div>
          </div>
        </div>

        <!-- 模态框 -->
        <div
          class="modal fade"
          id="confirmDeleteModal"
          tabindex="-1"
          aria-labelledby="confirmDeleteModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">
                  Confirm Delete
                </h5>
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Are you sure you want to delete this user?
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-dismiss="modal"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  class="btn btn-danger"
                  id="confirmDeleteButton"
                >
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>
        <footer>
          <p>
            Copyright &copy; 2016.Company name All rights reserved.<a
              target="_blank"
              href="http://sc.chinaz.com/moban/"
              >模板网站</a
            >
          </p>
        </footer>
      </div>
      <!-- /. PAGE INNER  -->
    </div>
    <!-- /. PAGE WRAPPER  -->
    <!-- /. WRAPPER  -->
    <!-- JS Scripts-->
    <!-- jQuery Js -->
    <script src="/assets/js/jquery-1.10.2.js"></script>
    <!-- Bootstrap Js -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Metis Menu Js -->
    <script src="/assets/js/jquery.metisMenu.js"></script>
    <!-- DATA TABLE SCRIPTS -->
    <script src="/assets/js/dataTables/jquery.dataTables.js"></script>
    <script src="/assets/js/dataTables/dataTables.bootstrap.js"></script>
    <script>
      $(document).ready(function () {
        var table = $('#dataTables-example').DataTable();

        $('#dataTables-example_filter').append(
          '<button id="addUser" class="btn btn-primary add-user-btn">Add User</button>',
        );

        $('#addUser').on('click', function () {
          window.location.href = '/user/create';
        });

        $(document).on('click', '.deleteLink', function (event) {
          event.preventDefault();
          var _id = $(this).data('id'); // 从 data-id 获取用户ID
          $('#confirmDeleteButton').data('id', _id); // 将用户ID存储到模态框按钮中
          $('#confirmDeleteModal').modal('show'); // 显示模态框
        });

        async function deleteUser(_id) {
          try {
            const response = await fetch(`/user/delete/${_id}`, {
              method: "POST",
            });
            window.location.href = "/user/";
            // const result = await response.json();
            // alert(result.message); // 显示反馈给用户
            location.reload(); // 刷新页面以更新用户表
          } catch (error) {
            alert("An error occurred while deleting the user.");
            console.error("Error:", error);
          }
        }

        $('#confirmDeleteButton').click(function () {
          var _id = $(this).data('id');
          deleteUser(_id);
        });
      });
    </script>
    <!-- Custom Js -->
    <script src="/assets/js/custom-scripts.js"></script>
  </body>
</html>
